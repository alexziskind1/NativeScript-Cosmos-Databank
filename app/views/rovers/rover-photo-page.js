"use strict";
var application = require("application");
var frame = require("ui/frame");
var rovers_view_model_1 = require("../../view-models/rovers/rovers-view-model");
var rovers_selection_1 = require("./rovers-selection");
var page;
var list;
var pageContainer;
var selectedRover;
var year;
var month;
var day;
var roversViewModel;
function onPageLoaded(args) {
    page = args.object;
}
exports.onPageLoaded = onPageLoaded;
function onPageNavigatedTo(args) {
    page = args.object;
    pageContainer = page.getViewById("pageContainer");
    var navgationContext = page.navigationContext;
    if (!roversViewModel || !(selectedRover === navgationContext["rover"]
        && year === navgationContext["year"]
        && month === navgationContext["month"]
        && day === navgationContext["day"])) {
        selectedRover = navgationContext["rover"];
        year = navgationContext["year"];
        month = navgationContext["month"];
        day = navgationContext["day"];
        selectedRover = navgationContext["rover"];
        switch (selectedRover) {
            case "curiosity":
                roversViewModel = new rovers_view_model_1.RoversViewModel(selectedRover, year, month, day);
                rovers_selection_1.pickersViewModel.set("day", day);
                rovers_selection_1.pickersViewModel.set("month", month);
                rovers_selection_1.pickersViewModel.set("year", year);
                rovers_selection_1.pickersViewModel.set("rover", selectedRover);
                break;
            case "opportunity":
                roversViewModel = new rovers_view_model_1.RoversViewModel(selectedRover, year, month, day);
                rovers_selection_1.pickersViewModel.set("dayOpp", day);
                rovers_selection_1.pickersViewModel.set("monthOpp", month);
                rovers_selection_1.pickersViewModel.set("yearOpp", year);
                rovers_selection_1.pickersViewModel.set("rover", selectedRover);
                break;
            case "spirit":
                roversViewModel = new rovers_view_model_1.RoversViewModel(selectedRover, year, month, day);
                rovers_selection_1.pickersViewModel.set("daySpi", day);
                rovers_selection_1.pickersViewModel.set("monthSpi", month);
                rovers_selection_1.pickersViewModel.set("yearSpi", year);
                rovers_selection_1.pickersViewModel.set("rover", selectedRover);
                break;
            default:
                break;
        }
        roversViewModel.initDataItems();
    }
    pageContainer.bindingContext = roversViewModel;
}
exports.onPageNavigatedTo = onPageNavigatedTo;
function onListLoaded(args) {
    list = args.object;
    if (list.items) {
        list.scrollToIndex(roversViewModel.get("cachedIndex"));
    }
    list.refresh();
}
exports.onListLoaded = onListLoaded;
function onItemTap(args) {
    var tappedItemIndex = args.itemIndex;
    roversViewModel.set("cachedIndex", tappedItemIndex);
    var tappedItem = roversViewModel.get("dataItems").getItem(tappedItemIndex);
    var navEntry = {
        moduleName: "views/rovers/photo-details-page",
        context: { "tappedItem": tappedItem },
        animated: true,
        transition: {
            name: application.android ? "explode" : "curl"
        }
    };
    frame.topmost().navigate(navEntry);
}
exports.onItemTap = onItemTap;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm92ZXItcGhvdG8tcGFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInJvdmVyLXBob3RvLXBhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUlBLHlDQUEyQztBQUUzQyxnQ0FBa0M7QUFFbEMsZ0ZBQXVGO0FBQ3ZGLHVEQUFzRDtBQUt0RCxJQUFJLElBQUksQ0FBQztBQUNULElBQUksSUFBSSxDQUFDO0FBQ1QsSUFBSSxhQUFhLENBQUM7QUFFbEIsSUFBSSxhQUFhLENBQUM7QUFDbEIsSUFBSSxJQUFJLENBQUM7QUFDVCxJQUFJLEtBQUssQ0FBQztBQUNWLElBQUksR0FBRyxDQUFDO0FBRVIsSUFBSSxlQUFlLENBQUM7QUFFcEIsc0JBQTZCLElBQWU7SUFDeEMsSUFBSSxHQUFTLElBQUksQ0FBQyxNQUFNLENBQUM7QUFDN0IsQ0FBQztBQUZELG9DQUVDO0FBRUQsMkJBQWtDLElBQWU7SUFDN0MsSUFBSSxHQUFTLElBQUksQ0FBQyxNQUFNLENBQUM7SUFFekIsYUFBYSxHQUFlLElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLENBQUM7SUFFOUQsSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUM7SUFFOUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxlQUFlLElBQUksQ0FBQyxDQUFDLGFBQWEsS0FBSyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7V0FDOUQsSUFBSSxLQUFLLGdCQUFnQixDQUFDLE1BQU0sQ0FBQztXQUNqQyxLQUFLLEtBQUssZ0JBQWdCLENBQUMsT0FBTyxDQUFDO1dBQ25DLEdBQUcsS0FBSyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV0QyxhQUFhLEdBQUcsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDMUMsSUFBSSxHQUFHLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hDLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNs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T0FBTyxHQUFHLFNBQVMsR0FBRyxNQUFNO1NBQ2pEO0tBQ0osQ0FBQztJQUVGLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDdkMsQ0FBQztBQWhCRCw4QkFnQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudERhdGEsIE9ic2VydmFibGUgfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlLWFycmF5XCI7XG5pbXBvcnQgeyBQYWdlIH0gZnJvbSBcInVpL3BhZ2VcIjtcbmltcG9ydCB7IEdyaWRMYXlvdXQgfSBmcm9tIFwidWkvbGF5b3V0cy9ncmlkLWxheW91dFwiO1xuaW1wb3J0ICogYXMgYXBwbGljYXRpb24gZnJvbSBcImFwcGxpY2F0aW9uXCI7XG5pbXBvcnQgKiBhcyBodHRwIGZyb20gXCJodHRwXCI7XG5pbXBvcnQgKiBhcyBmcmFtZSBmcm9tIFwidWkvZnJhbWVcIjtcblxuaW1wb3J0IHsgUm92ZXJzVmlld01vZGVsLCBEYXRhSXRlbSB9IGZyb20gXCIuLi8uLi92aWV3LW1vZGVscy9yb3ZlcnMvcm92ZXJzLXZpZXctbW9kZWxcIjtcbmltcG9ydCB7IHBpY2tlcnNWaWV3TW9kZWwgfSBmcm9tIFwiLi9yb3ZlcnMtc2VsZWN0aW9uXCI7XG5cbmltcG9ydCAqIGFzIFJhZExpc3R3TW9kdWxlIGZyb20gXCJuYXRpdmVzY3JpcHQtdGVsZXJpay11aS9saXN0dmlld1wiO1xuaW1wb3J0IHsgRnJlc2NvRHJhd2VlLCBGaW5hbEV2ZW50RGF0YSB9IGZyb20gXCJuYXRpdmVzY3JpcHQtZnJlc2NvXCI7XG5cbmxldCBwYWdlO1xubGV0IGxpc3Q7XG5sZXQgcGFnZUNvbnRhaW5lcjtcblxudmFyIHNlbGVjdGVkUm92ZXI7XG52YXIgeWVhcjtcbnZhciBtb250aDtcbnZhciBkYXk7XG5cbmxldCByb3ZlcnNWaWV3TW9kZWw7XG5cbmV4cG9ydCBmdW5jdGlvbiBvblBhZ2VMb2FkZWQoYXJnczogRXZlbnREYXRhKSB7XG4gICAgcGFnZSA9IDxQYWdlPmFyZ3Mub2JqZWN0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb25QYWdlTmF2aWdhdGVkVG8oYXJnczogRXZlbnREYXRhKSB7XG4gICAgcGFnZSA9IDxQYWdlPmFyZ3Mub2JqZWN0O1xuXG4gICAgcGFnZUNvbnRhaW5lciA9IDxHcmlkTGF5b3V0PnBhZ2UuZ2V0Vmlld0J5SWQoXCJwYWdlQ29udGFpbmVyXCIpO1xuXG4gICAgdmFyIG5hdmdhdGlvbkNvbnRleHQgPSBwYWdlLm5hdmlnYXRpb25Db250ZXh0O1xuXG4gICAgaWYgKCFyb3ZlcnNWaWV3TW9kZWwgfHwgIShzZWxlY3RlZFJvdmVyID09PSBuYXZnYXRpb25Db250ZXh0W1wicm92ZXJcIl1cbiAgICAgICAgJiYgeWVhciA9PT0gbmF2Z2F0aW9uQ29udGV4dFtcInllYXJcIl1cbiAgICAgICAgJiYgbW9udGggPT09IG5hdmdhdGlvbkNvbnRleHRbXCJtb250aFwiXVxuICAgICAgICAmJiBkYXkgPT09IG5hdmdhdGlvbkNvbnRleHRbXCJkYXlcIl0pKSB7XG5cbiAgICAgICAgc2VsZWN0ZWRSb3ZlciA9IG5hdmdhdGlvbkNvbnRleHRbXCJyb3ZlclwiXTtcbiAgICAgICAgeWVhciA9IG5hdmdhdGlvbkNvbnRleHRbXCJ5ZWFyXCJdO1xuICAgICAgICBtb250aCA9IG5hdmdhdGlvbkNvbnRleHRbXCJtb250aFwiXTtcbiAgICAgICAgZGF5ID0gbmF2Z2F0aW9uQ29udGV4dFtcImRheVwiXTtcbiAgICAgICAgc2VsZWN0ZWRSb3ZlciA9IG5hdmdhdGlvbkNvbnRleHRbXCJyb3ZlclwiXTtcblxuICAgICAgICBzd2l0Y2ggKHNlbGVjdGVkUm92ZXIpIHtcbiAgICAgICAgICAgIGNhc2UgXCJjdXJpb3NpdHlcIjpcbiAgICAgICAgICAgICAgICByb3ZlcnNWaWV3TW9kZWwgPSBuZXcgUm92ZXJzVmlld01vZGVsKHNlbGVjdGVkUm92ZXIsIHllYXIsIG1vbnRoLCBkYXkpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwiZGF5XCIsIGRheSk7XG4gICAgICAgICAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJtb250aFwiLCBtb250aCk7XG4gICAgICAgICAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJ5ZWFyXCIsIHllYXIpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwicm92ZXJcIiwgc2VsZWN0ZWRSb3Zlcik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwib3Bwb3J0dW5pdHlcIjpcbiAgICAgICAgICAgICAgICByb3ZlcnNWaWV3TW9kZWwgPSBuZXcgUm92ZXJzVmlld01vZGVsKHNlbGVjdGVkUm92ZXIsIHllYXIsIG1vbnRoLCBkYXkpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwiZGF5T3BwXCIsIGRheSk7XG4gICAgICAgICAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJtb250aE9wcFwiLCBtb250aCk7XG4gICAgICAgICAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJ5ZWFyT3BwXCIsIHllYXIpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwicm92ZXJcIiwgc2VsZWN0ZWRSb3Zlcik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic3Bpcml0XCI6XG4gICAgICAgICAgICAgICAgcm92ZXJzVmlld01vZGVsID0gbmV3IFJvdmVyc1ZpZXdNb2RlbChzZWxlY3RlZFJvdmVyLCB5ZWFyLCBtb250aCwgZGF5KTtcbiAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcImRheVNwaVwiLCBkYXkpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwibW9udGhTcGlcIiwgbW9udGgpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwieWVhclNwaVwiLCB5ZWFyKTtcbiAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcInJvdmVyXCIsIHNlbGVjdGVkUm92ZXIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHJvdmVyc1ZpZXdNb2RlbC5pbml0RGF0YUl0ZW1zKCk7XG4gICAgfVxuXG4gICAgcGFnZUNvbnRhaW5lci5iaW5kaW5nQ29udGV4dCA9IHJvdmVyc1ZpZXdNb2RlbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9uTGlzdExvYWRlZChhcmdzOiBSYWRMaXN0d01vZHVsZS5MaXN0Vmlld0V2ZW50RGF0YSkge1xuICAgIGxpc3QgPSA8UmFkTGlzdHdNb2R1bGUuUmFkTGlzdFZpZXc+YXJncy5vYmplY3Q7XG5cbiAgICBpZiAobGlzdC5pdGVtcykge1xuICAgICAgICBsaXN0LnNjcm9sbFRvSW5kZXgocm92ZXJzVmlld01vZGVsLmdldChcImNhY2hlZEluZGV4XCIpKTtcbiAgICB9XG5cbiAgICBsaXN0LnJlZnJlc2goKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9uSXRlbVRhcChhcmdzOiBSYWRMaXN0d01vZHVsZS5MaXN0Vmlld0V2ZW50RGF0YSkge1xuICAgIHZhciB0YXBwZWRJdGVtSW5kZXggPSBhcmdzLml0ZW1JbmRleDtcbiAgICByb3ZlcnNWaWV3TW9kZWwuc2V0KFwiY2FjaGVkSW5kZXhcIiwgdGFwcGVkSXRlbUluZGV4KTtcblxuICAgIHZhciB0YXBwZWRJdGVtID0gcm92ZXJzVmlld01vZGVsLmdldChcImRhdGFJdGVtc1wiKS5nZXRJdGVtKHRhcHBlZEl0ZW1JbmRleCk7XG5cbiAgICB2YXIgbmF2RW50cnkgPSB7XG4gICAgICAgIG1vZHVsZU5hbWU6IFwidmlld3Mvcm92ZXJzL3Bob3RvLWRldGFpbHMtcGFnZVwiLFxuICAgICAgICBjb250ZXh0OiB7IFwidGFwcGVkSXRlbVwiOiB0YXBwZWRJdGVtIH0sXG4gICAgICAgIGFuaW1hdGVkOiB0cnVlLFxuICAgICAgICB0cmFuc2l0aW9uOiB7XG4gICAgICAgICAgICBuYW1lOiBhcHBsaWNhdGlvbi5hbmRyb2lkID8gXCJleHBsb2RlXCIgOiBcImN1cmxcIlxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGZyYW1lLnRvcG1vc3QoKS5uYXZpZ2F0ZShuYXZFbnRyeSk7XG59XG4iXX0=