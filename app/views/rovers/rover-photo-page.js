"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var application = require("application");
var frame = require("ui/frame");
var rovers_view_model_1 = require("../../view-models/rovers/rovers-view-model");
var rovers_selection_1 = require("./rovers-selection");
var page;
var list;
var pageContainer;
var selectedRover;
var year;
var month;
var day;
var roversViewModel;
function onPageLoaded(args) {
    page = args.object;
}
exports.onPageLoaded = onPageLoaded;
function onPageNavigatedTo(args) {
    page = args.object;
    pageContainer = page.getViewById("pageContainer");
    var navgationContext = page.navigationContext;
    if (!roversViewModel || !(selectedRover === navgationContext["rover"]
        && year === navgationContext["year"]
        && month === navgationContext["month"]
        && day === navgationContext["day"])) {
        selectedRover = navgationContext["rover"];
        year = navgationContext["year"];
        month = navgationContext["month"];
        day = navgationContext["day"];
        selectedRover = navgationContext["rover"];
        switch (selectedRover) {
            case "curiosity":
                roversViewModel = new rovers_view_model_1.RoversViewModel(selectedRover, year, month, day);
                rovers_selection_1.pickersViewModel.set("day", day);
                rovers_selection_1.pickersViewModel.set("month", month);
                rovers_selection_1.pickersViewModel.set("year", year);
                rovers_selection_1.pickersViewModel.set("rover", selectedRover);
                break;
            case "opportunity":
                roversViewModel = new rovers_view_model_1.RoversViewModel(selectedRover, year, month, day);
                rovers_selection_1.pickersViewModel.set("dayOpp", day);
                rovers_selection_1.pickersViewModel.set("monthOpp", month);
                rovers_selection_1.pickersViewModel.set("yearOpp", year);
                rovers_selection_1.pickersViewModel.set("rover", selectedRover);
                break;
            case "spirit":
                roversViewModel = new rovers_view_model_1.RoversViewModel(selectedRover, year, month, day);
                rovers_selection_1.pickersViewModel.set("daySpi", day);
                rovers_selection_1.pickersViewModel.set("monthSpi", month);
                rovers_selection_1.pickersViewModel.set("yearSpi", year);
                rovers_selection_1.pickersViewModel.set("rover", selectedRover);
                break;
            default:
                break;
        }
        roversViewModel.initDataItems();
    }
    pageContainer.bindingContext = roversViewModel;
}
exports.onPageNavigatedTo = onPageNavigatedTo;
function onListLoaded(args) {
    list = args.object;
    if (list.items) {
        list.scrollToIndex(roversViewModel.get("cachedIndex"));
    }
    list.refresh();
}
exports.onListLoaded = onListLoaded;
function onItemTap(args) {
    var tappedItemIndex = args.index;
    roversViewModel.set("cachedIndex", tappedItemIndex);
    var tappedItem = roversViewModel.get("dataItems").getItem(tappedItemIndex);
    var navEntry = {
        moduleName: "views/rovers/photo-details-page",
        context: { "tappedItem": tappedItem },
        animated: true,
        transition: {
            name: application.android ? "explode" : "curl"
        }
    };
    frame.topmost().navigate(navEntry);
}
exports.onItemTap = onItemTap;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm92ZXItcGhvdG8tcGFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInJvdmVyLXBob3RvLXBhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSx5Q0FBMkM7QUFFM0MsZ0NBQWtDO0FBRWxDLGdGQUF1RjtBQUN2Rix1REFBc0Q7QUFLdEQsSUFBSSxJQUFJLENBQUM7QUFDVCxJQUFJLElBQUksQ0FBQztBQUNULElBQUksYUFBYSxDQUFDO0FBRWxCLElBQUksYUFBYSxDQUFDO0FBQ2xCLElBQUksSUFBSSxDQUFDO0FBQ1QsSUFBSSxLQUFLLENBQUM7QUFDVixJQUFJLEdBQUcsQ0FBQztBQUVSLElBQUksZUFBZSxDQUFDO0FBRXBCLHNCQUE2QixJQUFlO0lBQ3hDLElBQUksR0FBUyxJQUFJLENBQUMsTUFBTSxDQUFDO0FBQzdCLENBQUM7QUFGRCxvQ0FFQztBQUVELDJCQUFrQyxJQUFlO0lBQzdDLElBQUksR0FBUyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBRXpCLGFBQWEsR0FBZSxJQUFJLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBRTlELElBQUksZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDO0lBRTlDLEVBQUUsQ0FBQyxDQUFDLENBQUMsZUFBZSxJQUFJLENBQUMsQ0FBQyxhQUFhLEtBQUssZ0JBQWdCLENBQUMsT0FBTyxDQUFDO1dBQzlELElBQUksS0FBSyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUM7V0FDakMsS0FBSyxLQUFLLGdCQUFnQixDQUFDLE9BQU8sQ0FBQztXQUNuQyxHQUFHLEtBQUssZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFdEMsYUFBYSxHQUFHLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzFDLElBQUksR0FBRyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoQyxLQUFLLEdBQUcsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7UUFD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LE9BQU8sR0FBRyxTQUFTLEdBQUcsTUFBTTtTQUNqRDtLQUNKLENBQUM7SUFFRixLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3ZDLENBQUM7QUFoQkQsOEJBZ0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnREYXRhLCBPYnNlcnZhYmxlIH0gZnJvbSBcImRhdGEvb2JzZXJ2YWJsZVwiO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZUFycmF5IH0gZnJvbSBcImRhdGEvb2JzZXJ2YWJsZS1hcnJheVwiO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gXCJ1aS9wYWdlXCI7XG5pbXBvcnQgeyBHcmlkTGF5b3V0IH0gZnJvbSBcInVpL2xheW91dHMvZ3JpZC1sYXlvdXRcIjtcbmltcG9ydCAqIGFzIGFwcGxpY2F0aW9uIGZyb20gXCJhcHBsaWNhdGlvblwiO1xuaW1wb3J0ICogYXMgaHR0cCBmcm9tIFwiaHR0cFwiO1xuaW1wb3J0ICogYXMgZnJhbWUgZnJvbSBcInVpL2ZyYW1lXCI7XG5cbmltcG9ydCB7IFJvdmVyc1ZpZXdNb2RlbCwgRGF0YUl0ZW0gfSBmcm9tIFwiLi4vLi4vdmlldy1tb2RlbHMvcm92ZXJzL3JvdmVycy12aWV3LW1vZGVsXCI7XG5pbXBvcnQgeyBwaWNrZXJzVmlld01vZGVsIH0gZnJvbSBcIi4vcm92ZXJzLXNlbGVjdGlvblwiO1xuXG5pbXBvcnQgKiBhcyBSYWRMaXN0d01vZHVsZSBmcm9tIFwibmF0aXZlc2NyaXB0LXRlbGVyaWstdWkvbGlzdHZpZXdcIjtcbmltcG9ydCB7IEZyZXNjb0RyYXdlZSwgRmluYWxFdmVudERhdGEgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWZyZXNjb1wiO1xuXG5sZXQgcGFnZTtcbmxldCBsaXN0O1xubGV0IHBhZ2VDb250YWluZXI7XG5cbnZhciBzZWxlY3RlZFJvdmVyO1xudmFyIHllYXI7XG52YXIgbW9udGg7XG52YXIgZGF5O1xuXG5sZXQgcm92ZXJzVmlld01vZGVsO1xuXG5leHBvcnQgZnVuY3Rpb24gb25QYWdlTG9hZGVkKGFyZ3M6IEV2ZW50RGF0YSkge1xuICAgIHBhZ2UgPSA8UGFnZT5hcmdzLm9iamVjdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9uUGFnZU5hdmlnYXRlZFRvKGFyZ3M6IEV2ZW50RGF0YSkge1xuICAgIHBhZ2UgPSA8UGFnZT5hcmdzLm9iamVjdDtcblxuICAgIHBhZ2VDb250YWluZXIgPSA8R3JpZExheW91dD5wYWdlLmdldFZpZXdCeUlkKFwicGFnZUNvbnRhaW5lclwiKTtcblxuICAgIHZhciBuYXZnYXRpb25Db250ZXh0ID0gcGFnZS5uYXZpZ2F0aW9uQ29udGV4dDtcblxuICAgIGlmICghcm92ZXJzVmlld01vZGVsIHx8ICEoc2VsZWN0ZWRSb3ZlciA9PT0gbmF2Z2F0aW9uQ29udGV4dFtcInJvdmVyXCJdXG4gICAgICAgICYmIHllYXIgPT09IG5hdmdhdGlvbkNvbnRleHRbXCJ5ZWFyXCJdXG4gICAgICAgICYmIG1vbnRoID09PSBuYXZnYXRpb25Db250ZXh0W1wibW9udGhcIl1cbiAgICAgICAgJiYgZGF5ID09PSBuYXZnYXRpb25Db250ZXh0W1wiZGF5XCJdKSkge1xuXG4gICAgICAgIHNlbGVjdGVkUm92ZXIgPSBuYXZnYXRpb25Db250ZXh0W1wicm92ZXJcIl07XG4gICAgICAgIHllYXIgPSBuYXZnYXRpb25Db250ZXh0W1wieWVhclwiXTtcbiAgICAgICAgbW9udGggPSBuYXZnYXRpb25Db250ZXh0W1wibW9udGhcIl07XG4gICAgICAgIGRheSA9IG5hdmdhdGlvbkNvbnRleHRbXCJkYXlcIl07XG4gICAgICAgIHNlbGVjdGVkUm92ZXIgPSBuYXZnYXRpb25Db250ZXh0W1wicm92ZXJcIl07XG5cbiAgICAgICAgc3dpdGNoIChzZWxlY3RlZFJvdmVyKSB7XG4gICAgICAgICAgICBjYXNlIFwiY3VyaW9zaXR5XCI6XG4gICAgICAgICAgICAgICAgcm92ZXJzVmlld01vZGVsID0gbmV3IFJvdmVyc1ZpZXdNb2RlbChzZWxlY3RlZFJvdmVyLCB5ZWFyLCBtb250aCwgZGF5KTtcbiAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcImRheVwiLCBkYXkpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwibW9udGhcIiwgbW9udGgpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwieWVhclwiLCB5ZWFyKTtcbiAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcInJvdmVyXCIsIHNlbGVjdGVkUm92ZXIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm9wcG9ydHVuaXR5XCI6XG4gICAgICAgICAgICAgICAgcm92ZXJzVmlld01vZGVsID0gbmV3IFJvdmVyc1ZpZXdNb2RlbChzZWxlY3RlZFJvdmVyLCB5ZWFyLCBtb250aCwgZGF5KTtcbiAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcImRheU9wcFwiLCBkYXkpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwibW9udGhPcHBcIiwgbW9udGgpO1xuICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwieWVhck9wcFwiLCB5ZWFyKTtcbiAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcInJvdmVyXCIsIHNlbGVjdGVkUm92ZXIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInNwaXJpdFwiOlxuICAgICAgICAgICAgICAgIHJvdmVyc1ZpZXdNb2RlbCA9IG5ldyBSb3ZlcnNWaWV3TW9kZWwoc2VsZWN0ZWRSb3ZlciwgeWVhciwgbW9udGgsIGRheSk7XG4gICAgICAgICAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJkYXlTcGlcIiwgZGF5KTtcbiAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcIm1vbnRoU3BpXCIsIG1vbnRoKTtcbiAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcInllYXJTcGlcIiwgeWVhcik7XG4gICAgICAgICAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJyb3ZlclwiLCBzZWxlY3RlZFJvdmVyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICByb3ZlcnNWaWV3TW9kZWwuaW5pdERhdGFJdGVtcygpO1xuICAgIH1cblxuICAgIHBhZ2VDb250YWluZXIuYmluZGluZ0NvbnRleHQgPSByb3ZlcnNWaWV3TW9kZWw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvbkxpc3RMb2FkZWQoYXJnczogUmFkTGlzdHdNb2R1bGUuTGlzdFZpZXdFdmVudERhdGEpIHtcbiAgICBsaXN0ID0gPFJhZExpc3R3TW9kdWxlLlJhZExpc3RWaWV3PmFyZ3Mub2JqZWN0O1xuXG4gICAgaWYgKGxpc3QuaXRlbXMpIHtcbiAgICAgICAgbGlzdC5zY3JvbGxUb0luZGV4KHJvdmVyc1ZpZXdNb2RlbC5nZXQoXCJjYWNoZWRJbmRleFwiKSk7XG4gICAgfVxuXG4gICAgbGlzdC5yZWZyZXNoKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvbkl0ZW1UYXAoYXJnczogUmFkTGlzdHdNb2R1bGUuTGlzdFZpZXdFdmVudERhdGEpIHtcbiAgICB2YXIgdGFwcGVkSXRlbUluZGV4ID0gYXJncy5pbmRleDtcbiAgICByb3ZlcnNWaWV3TW9kZWwuc2V0KFwiY2FjaGVkSW5kZXhcIiwgdGFwcGVkSXRlbUluZGV4KTtcblxuICAgIHZhciB0YXBwZWRJdGVtID0gcm92ZXJzVmlld01vZGVsLmdldChcImRhdGFJdGVtc1wiKS5nZXRJdGVtKHRhcHBlZEl0ZW1JbmRleCk7XG5cbiAgICB2YXIgbmF2RW50cnkgPSB7XG4gICAgICAgIG1vZHVsZU5hbWU6IFwidmlld3Mvcm92ZXJzL3Bob3RvLWRldGFpbHMtcGFnZVwiLFxuICAgICAgICBjb250ZXh0OiB7IFwidGFwcGVkSXRlbVwiOiB0YXBwZWRJdGVtIH0sXG4gICAgICAgIGFuaW1hdGVkOiB0cnVlLFxuICAgICAgICB0cmFuc2l0aW9uOiB7XG4gICAgICAgICAgICBuYW1lOiBhcHBsaWNhdGlvbi5hbmRyb2lkID8gXCJleHBsb2RlXCIgOiBcImN1cmxcIlxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGZyYW1lLnRvcG1vc3QoKS5uYXZpZ2F0ZShuYXZFbnRyeSk7XG59XG4iXX0=