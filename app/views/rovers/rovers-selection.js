"use strict";
// tslint:disable:max-line-length
var observable_1 = require("data/observable");
var pickers_view_model_1 = require("../../view-models/rovers/pickers-view-model");
var app = require("application");
exports.pickersViewModel = new pickers_view_model_1.PickersViewModel();
var page;
var dtCur;
var dtOpp;
var dtSpi;
function onPageLoaded(args) {
    page = args.object;
}
exports.onPageLoaded = onPageLoaded;
function onPageNavigatedTo(args) {
    page = args.object;
    dtCur = page.getViewById("dt-cur");
    dtOpp = page.getViewById("dt-opp");
    dtSpi = page.getViewById("dt-spi");
    initDatePickers();
    initSegmentedBars();
    initTabs();
    page.bindingContext = exports.pickersViewModel;
}
exports.onPageNavigatedTo = onPageNavigatedTo;
function onTabLoaded(args) {
    var tabView = args.object;
    if (app.android) {
        for (var i = 0; i < tabView.items.length; i++) {
            tabView._tabLayout.getTextViewForItemAt(i).setHorizontallyScrolling(true);
        }
    }
}
exports.onTabLoaded = onTabLoaded;
function initTabs() {
    exports.pickersViewModel.addEventListener(observable_1.Observable.propertyChangeEvent, function (args) {
        if (args.propertyName.toString() === "tabIndex") {
            initDatePickers();
        }
    });
}
function initDatePickers() {
    var today = new Date();
    dtCur.minDate = new Date(2012, 6 + 1, 6); // Landing date: 6th August 2012
    dtCur.maxDate = today; // still active
    dtOpp.minDate = new Date(2004, 0, 26); // Landing date: 25th January 2004 - first pics on 26th
    dtOpp.maxDate = today; // still active 
    dtSpi.minDate = new Date(2004, 0, 5); // Landing date: 4th January 2004 - first pics on 5th
    dtSpi.maxDate = new Date(2010, 1 + 1, 21); // last communication March
    if (!exports.pickersViewModel.get("rover")) {
        dtCur.day = today.getDate() - 2;
        dtCur.month = today.getMonth() + 1;
        dtCur.year = today.getFullYear();
        dtOpp.day = today.getDate() - 2;
        dtOpp.month = today.getMonth() + 1;
        dtOpp.year = today.getFullYear();
        dtSpi.day = today.getDate() - 2;
        dtSpi.month = today.getMonth() + 1;
        dtSpi.year = 2007;
        exports.pickersViewModel.set("day", dtCur.day);
        exports.pickersViewModel.set("month", dtCur.month);
        exports.pickersViewModel.set("year", dtCur.year);
        exports.pickersViewModel.set("dayOpp", dtOpp.day);
        exports.pickersViewModel.set("monthOpp", dtOpp.month);
        exports.pickersViewModel.set("yearOpp", dtOpp.year);
        exports.pickersViewModel.set("daySpi", dtSpi.day);
        exports.pickersViewModel.set("monthSpi", dtSpi.month);
        exports.pickersViewModel.set("yearSpi", dtSpi.year);
    }
    else {
        dtCur.day = exports.pickersViewModel.get("day");
        dtCur.month = exports.pickersViewModel.get("month");
        dtCur.year = exports.pickersViewModel.get("year");
        dtOpp.day = exports.pickersViewModel.get("dayOpp");
        dtOpp.month = exports.pickersViewModel.get("monthOpp");
        dtOpp.year = exports.pickersViewModel.get("yearOpp");
        dtSpi.day = exports.pickersViewModel.get("daySpi");
        dtSpi.month = exports.pickersViewModel.get("monthSpi");
        dtSpi.year = exports.pickersViewModel.get("yearSpi");
    }
}
function initSegmentedBars() {
    exports.pickersViewModel.set("selectedIndexCur", 1);
    exports.pickersViewModel.set("selectedIndexOpp", 1);
    exports.pickersViewModel.set("selectedIndexSpi", 1);
    exports.pickersViewModel.set("isCurInfoVisible", false);
    exports.pickersViewModel.set("isOppInfoVisible", false);
    exports.pickersViewModel.set("isSpiInfoVisible", false);
    exports.pickersViewModel.set("curiosityDescription", "Curiosity is a car-sized robotic rover exploring Gale Crater on Mars as part of NASA's Mars Science Laboratory mission (MSL)");
    exports.pickersViewModel.set("opporunityDescription", "Curiosity is a car-sized robotic rover exploring Gale Crater on Mars as part of NASA's Mars Science Laboratory mission (MSL)");
    exports.pickersViewModel.set("spiritDescription", "Curiosity is a car-sized robotic rover exploring Gale Crater on Mars as part of NASA's Mars Science Laboratory mission (MSL)");
    exports.pickersViewModel.addEventListener(observable_1.Observable.propertyChangeEvent, function (args) {
        if (args.propertyName.toString() === "selectedIndexCur") {
            switch (args.value) {
                case 0:
                    exports.pickersViewModel.set("isCurInfoVisible", true);
                    break;
                case 1:
                    exports.pickersViewModel.set("isCurInfoVisible", false);
                    break;
                default:
                    break;
            }
        }
    });
    exports.pickersViewModel.addEventListener(observable_1.Observable.propertyChangeEvent, function (args) {
        if (args.propertyName.toString() === "selectedIndexOpp") {
            switch (args.value) {
                case 0:
                    exports.pickersViewModel.set("isOppInfoVisible", true);
                    break;
                case 1:
                    exports.pickersViewModel.set("isOppInfoVisible", false);
                    break;
                default:
                    break;
            }
        }
    });
    exports.pickersViewModel.addEventListener(observable_1.Observable.propertyChangeEvent, function (args) {
        if (args.propertyName.toString() === "selectedIndexSpi") {
            switch (args.value) {
                case 0:
                    exports.pickersViewModel.set("isSpiInfoVisible", true);
                    break;
                case 1:
                    exports.pickersViewModel.set("isSpiInfoVisible", false);
                    break;
                default:
                    break;
            }
        }
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm92ZXJzLXNlbGVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInJvdmVycy1zZWxlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLGlDQUFpQztBQUNqQyw4Q0FBNEU7QUFTNUUsa0ZBQStFO0FBRS9FLGlDQUFtQztBQUV4QixRQUFBLGdCQUFnQixHQUFHLElBQUkscUNBQWdCLEVBQUUsQ0FBQztBQUNyRCxJQUFJLElBQUksQ0FBQztBQUNULElBQUksS0FBSyxDQUFDO0FBQ1YsSUFBSSxLQUFLLENBQUM7QUFDVixJQUFJLEtBQUssQ0FBQztBQUVWLHNCQUE2QixJQUFlO0lBQ3hDLElBQUksR0FBUyxJQUFJLENBQUMsTUFBTSxDQUFDO0FBQzdCLENBQUM7QUFGRCxvQ0FFQztBQUVELDJCQUFrQyxJQUFlO0lBQzdDLElBQUksR0FBUyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBRXpCLEtBQUssR0FBZSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQy9DLEtBQUssR0FBZSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQy9DLEtBQUssR0FBZSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBRS9DLGVBQWUsRUFBRSxDQUFDO0lBQ2xCLGlCQUFpQixFQUFFLENBQUM7SUFDcEIsUUFBUSxFQUFFLENBQUM7SUFFWCxJQUFJLENBQUMsY0FBYyxHQUFHLHdCQUFnQixDQUFDO0FBQzNDLENBQUM7QUFaRCw4Q0FZQztBQUVELHFCQUE0QixJQUFJO0lBQzVCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDMUIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDZCxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFB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LENBQUM7UUFFNUMsd0JBQWdCLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDMUMsd0JBQWdCLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDOUMsd0JBQWdCLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ0osS0FBSyxDQUFDLEdBQUcsR0FBRyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEMsS0FBSyxDQUFDLEtBQUssR0FBRyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDNUMsS0FBSyxDQUFDLElBQUksR0FBRyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFMUMsS0FBSyxDQUFDLEdBQUcsR0FBRyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0MsS0FBSyxDQUFDLEtBQUssR0FBRyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDL0MsS0FBSyxDQUFDLElBQUksR0FBRyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFN0MsS0FBSyxDQUFDLEdBQUcsR0FBRyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0MsS0FBSyxDQUFDLEtBQUssR0FBRyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDL0MsS0FBSyxDQUFDLElBQUksR0FBRyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDakQsQ0FBQztBQUNMLENBQUM7QUFFRDtJQUNJLHdCQUFnQixDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM1Qyx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUMsd0JBQWdCLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRTVDLHdCQUFnQixDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNoRCx3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDaEQsd0JBQWdCLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxDQUFDO0lBRWhELHdCQUFnQixDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsRUFBRSw4SEFBOEgsQ0FBQyxDQUFDO0lBQzdLLHdCQUFnQixDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsRUFBRSw4SEFBOEgsQ0FBQyxDQUFDO0lBQzlLLHdCQUFnQixDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSw4SEFBOEgsQ0FBQyxDQUFDO0lBRTFLLHdCQUFnQixDQUFDLGdCQUFnQixDQUFDLHVCQUFVLENBQUMsbUJBQW1CLEVBQUUsVUFBVSxJQUF3QjtRQUNoRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxLQUFLLGtCQUFrQixDQUFDLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDakIsS0FBSyxDQUFDO29CQUNGLHdCQUFnQixDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFDL0MsS0FBSyxDQUFDO2dCQUNWLEtBQUssQ0FBQztvQkFDRix3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsS0FBSyxDQUFDLENBQUM7b0JBQ2hELEtBQUssQ0FBQztnQkFDVjtvQkFDSSxLQUFLLENBQUM7WUFDZCxDQUFDO1FBQ0wsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsd0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsdUJBQVUsQ0FBQyxtQkFBbUIsRUFBRSxVQUFVLElBQXdCO1FBQ2hHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLEtBQUssa0JBQWtCLENBQUMsQ0FBQyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixLQUFLLENBQUM7b0JBQ0Ysd0JBQWdCLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLElBQUksQ0FBQyxDQUFDO29CQUMvQyxLQUFLLENBQUM7Z0JBQ1YsS0FBSyxDQUFDO29CQUNGLHdCQUFnQixDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLENBQUMsQ0FBQztvQkFDaEQsS0FBSyxDQUFDO2dCQUNWO29CQUNJLEtBQUssQ0FBQztZQUNkLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCx3QkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyx1QkFBVSxDQUFDLG1CQUFtQixFQUFFLFVBQVUsSUFBd0I7UUFDaEcsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsS0FBSyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7WUFDdEQsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLEtBQUssQ0FBQztvQkFDRix3QkFBZ0IsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLENBQUM7b0JBQy9DLEtBQUssQ0FBQztnQkFDVixLQUFLLENBQUM7b0JBQ0Ysd0JBQWdCLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxDQUFDO29CQUNoRCxLQUFLLENBQUM7Z0JBQ1Y7b0JBQ0ksS0FBSyxDQUFDO1lBQ2QsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZTptYXgtbGluZS1sZW5ndGhcbmltcG9ydCB7IEV2ZW50RGF0YSwgT2JzZXJ2YWJsZSwgUHJvcGVydHlDaGFuZ2VEYXRhIH0gZnJvbSBcImRhdGEvb2JzZXJ2YWJsZVwiO1xuaW1wb3J0IHsgdG9wbW9zdCB9IGZyb20gXCJ1aS9mcmFtZVwiO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gXCJ1aS9wYWdlXCI7XG5pbXBvcnQgeyBEYXRlUGlja2VyIH0gZnJvbSBcInVpL2RhdGUtcGlja2VyXCI7XG5pbXBvcnQgeyBTZWdtZW50ZWRCYXIgfSBmcm9tIFwidWkvc2VnbWVudGVkLWJhclwiO1xuaW1wb3J0IHsgVGFiVmlldywgU2VsZWN0ZWRJbmRleENoYW5nZWRFdmVudERhdGEgfSBmcm9tIFwidWkvdGFiLXZpZXdcIjtcblxuaW1wb3J0IGRyYXdlck1vZHVsZSA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtdGVsZXJpay11aS9zaWRlZHJhd2VyXCIpO1xuXG5pbXBvcnQgeyBQaWNrZXJzVmlld01vZGVsIH0gZnJvbSBcIi4uLy4uL3ZpZXctbW9kZWxzL3JvdmVycy9waWNrZXJzLXZpZXctbW9kZWxcIjtcblxuaW1wb3J0ICogYXMgYXBwIGZyb20gXCJhcHBsaWNhdGlvblwiO1xuXG5leHBvcnQgbGV0IHBpY2tlcnNWaWV3TW9kZWwgPSBuZXcgUGlja2Vyc1ZpZXdNb2RlbCgpO1xubGV0IHBhZ2U7XG5sZXQgZHRDdXI7XG5sZXQgZHRPcHA7XG5sZXQgZHRTcGk7XG5cbmV4cG9ydCBmdW5jdGlvbiBvblBhZ2VMb2FkZWQoYXJnczogRXZlbnREYXRhKSB7XG4gICAgcGFnZSA9IDxQYWdlPmFyZ3Mub2JqZWN0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb25QYWdlTmF2aWdhdGVkVG8oYXJnczogRXZlbnREYXRhKSB7XG4gICAgcGFnZSA9IDxQYWdlPmFyZ3Mub2JqZWN0O1xuXG4gICAgZHRDdXIgPSA8RGF0ZVBpY2tlcj5wYWdlLmdldFZpZXdCeUlkKFwiZHQtY3VyXCIpO1xuICAgIGR0T3BwID0gPERhdGVQaWNrZXI+cGFnZS5nZXRWaWV3QnlJZChcImR0LW9wcFwiKTtcbiAgICBkdFNwaSA9IDxEYXRlUGlja2VyPnBhZ2UuZ2V0Vmlld0J5SWQoXCJkdC1zcGlcIik7XG5cbiAgICBpbml0RGF0ZVBpY2tlcnMoKTtcbiAgICBpbml0U2VnbWVudGVkQmFycygpO1xuICAgIGluaXRUYWJzKCk7XG5cbiAgICBwYWdlLmJpbmRpbmdDb250ZXh0ID0gcGlja2Vyc1ZpZXdNb2RlbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9uVGFiTG9hZGVkKGFyZ3MpIHtcbiAgICB2YXIgdGFiVmlldyA9IGFyZ3Mub2JqZWN0O1xuICAgIGlmIChhcHAuYW5kcm9pZCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhYlZpZXcuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRhYlZpZXcuX3RhYkxheW91dC5nZXRUZXh0Vmlld0Zvckl0ZW1BdChpKS5zZXRIb3Jpem9udGFsbHlTY3JvbGxpbmcodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGluaXRUYWJzKCkge1xuICAgIHBpY2tlcnNWaWV3TW9kZWwuYWRkRXZlbnRMaXN0ZW5lcihPYnNlcnZhYmxlLnByb3BlcnR5Q2hhbmdlRXZlbnQsIGZ1bmN0aW9uIChhcmdzOiBQcm9wZXJ0eUNoYW5nZURhdGEpIHtcbiAgICAgICAgaWYgKGFyZ3MucHJvcGVydHlOYW1lLnRvU3RyaW5nKCkgPT09IFwidGFiSW5kZXhcIikge1xuICAgICAgICAgICAgaW5pdERhdGVQaWNrZXJzKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaW5pdERhdGVQaWNrZXJzKCkge1xuICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7XG5cbiAgICBkdEN1ci5taW5EYXRlID0gbmV3IERhdGUoMjAxMiwgNiArIDEsIDYpOyAvLyBMYW5kaW5nIGRhdGU6IDZ0aCBBdWd1c3QgMjAxMlxuICAgIGR0Q3VyLm1heERhdGUgPSB0b2RheTsgLy8gc3RpbGwgYWN0aXZlXG5cbiAgICBkdE9wcC5taW5EYXRlID0gbmV3IERhdGUoMjAwNCwgMCwgMjYpOyAvLyBMYW5kaW5nIGRhdGU6IDI1dGggSmFudWFyeSAyMDA0IC0gZmlyc3QgcGljcyBvbiAyNnRoXG4gICAgZHRPcHAubWF4RGF0ZSA9IHRvZGF5OyAvLyBzdGlsbCBhY3RpdmUgXG5cbiAgICBkdFNwaS5taW5EYXRlID0gbmV3IERhdGUoMjAwNCwgMCwgNSk7IC8vIExhbmRpbmcgZGF0ZTogNHRoIEphbnVhcnkgMjAwNCAtIGZpcnN0IHBpY3Mgb24gNXRoXG4gICAgZHRTcGkubWF4RGF0ZSA9IG5ldyBEYXRlKDIwMTAsIDEgKyAxLCAyMSk7IC8vIGxhc3QgY29tbXVuaWNhdGlvbiBNYXJjaFxuXG4gICAgaWYgKCFwaWNrZXJzVmlld01vZGVsLmdldChcInJvdmVyXCIpKSB7XG4gICAgICAgIGR0Q3VyLmRheSA9IHRvZGF5LmdldERhdGUoKSAtIDI7XG4gICAgICAgIGR0Q3VyLm1vbnRoID0gdG9kYXkuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgIGR0Q3VyLnllYXIgPSB0b2RheS5nZXRGdWxsWWVhcigpO1xuXG4gICAgICAgIGR0T3BwLmRheSA9IHRvZGF5LmdldERhdGUoKSAtIDI7XG4gICAgICAgIGR0T3BwLm1vbnRoID0gdG9kYXkuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgIGR0T3BwLnllYXIgPSB0b2RheS5nZXRGdWxsWWVhcigpO1xuXG4gICAgICAgIGR0U3BpLmRheSA9IHRvZGF5LmdldERhdGUoKSAtIDI7XG4gICAgICAgIGR0U3BpLm1vbnRoID0gdG9kYXkuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgIGR0U3BpLnllYXIgPSAyMDA3O1xuXG4gICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwiZGF5XCIsIGR0Q3VyLmRheSk7XG4gICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwibW9udGhcIiwgZHRDdXIubW9udGgpO1xuICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcInllYXJcIiwgZHRDdXIueWVhcik7XG5cbiAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJkYXlPcHBcIiwgZHRPcHAuZGF5KTtcbiAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJtb250aE9wcFwiLCBkdE9wcC5tb250aCk7XG4gICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwieWVhck9wcFwiLCBkdE9wcC55ZWFyKTtcblxuICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcImRheVNwaVwiLCBkdFNwaS5kYXkpO1xuICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcIm1vbnRoU3BpXCIsIGR0U3BpLm1vbnRoKTtcbiAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJ5ZWFyU3BpXCIsIGR0U3BpLnllYXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGR0Q3VyLmRheSA9IHBpY2tlcnNWaWV3TW9kZWwuZ2V0KFwiZGF5XCIpO1xuICAgICAgICBkdEN1ci5tb250aCA9IHBpY2tlcnNWaWV3TW9kZWwuZ2V0KFwibW9udGhcIik7XG4gICAgICAgIGR0Q3VyLnllYXIgPSBwaWNrZXJzVmlld01vZGVsLmdldChcInllYXJcIik7XG5cbiAgICAgICAgZHRPcHAuZGF5ID0gcGlja2Vyc1ZpZXdNb2RlbC5nZXQoXCJkYXlPcHBcIik7XG4gICAgICAgIGR0T3BwLm1vbnRoID0gcGlja2Vyc1ZpZXdNb2RlbC5nZXQoXCJtb250aE9wcFwiKTtcbiAgICAgICAgZHRPcHAueWVhciA9IHBpY2tlcnNWaWV3TW9kZWwuZ2V0KFwieWVhck9wcFwiKTtcblxuICAgICAgICBkdFNwaS5kYXkgPSBwaWNrZXJzVmlld01vZGVsLmdldChcImRheVNwaVwiKTtcbiAgICAgICAgZHRTcGkubW9udGggPSBwaWNrZXJzVmlld01vZGVsLmdldChcIm1vbnRoU3BpXCIpO1xuICAgICAgICBkdFNwaS55ZWFyID0gcGlja2Vyc1ZpZXdNb2RlbC5nZXQoXCJ5ZWFyU3BpXCIpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gaW5pdFNlZ21lbnRlZEJhcnMoKSB7XG4gICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJzZWxlY3RlZEluZGV4Q3VyXCIsIDEpO1xuICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwic2VsZWN0ZWRJbmRleE9wcFwiLCAxKTtcbiAgICBwaWNrZXJzVmlld01vZGVsLnNldChcInNlbGVjdGVkSW5kZXhTcGlcIiwgMSk7XG5cbiAgICBwaWNrZXJzVmlld01vZGVsLnNldChcImlzQ3VySW5mb1Zpc2libGVcIiwgZmFsc2UpO1xuICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwiaXNPcHBJbmZvVmlzaWJsZVwiLCBmYWxzZSk7XG4gICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJpc1NwaUluZm9WaXNpYmxlXCIsIGZhbHNlKTtcblxuICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwiY3VyaW9zaXR5RGVzY3JpcHRpb25cIiwgXCJDdXJpb3NpdHkgaXMgYSBjYXItc2l6ZWQgcm9ib3RpYyByb3ZlciBleHBsb3JpbmcgR2FsZSBDcmF0ZXIgb24gTWFycyBhcyBwYXJ0IG9mIE5BU0EncyBNYXJzIFNjaWVuY2UgTGFib3JhdG9yeSBtaXNzaW9uIChNU0wpXCIpO1xuICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwib3Bwb3J1bml0eURlc2NyaXB0aW9uXCIsIFwiQ3VyaW9zaXR5IGlzIGEgY2FyLXNpemVkIHJvYm90aWMgcm92ZXIgZXhwbG9yaW5nIEdhbGUgQ3JhdGVyIG9uIE1hcnMgYXMgcGFydCBvZiBOQVNBJ3MgTWFycyBTY2llbmNlIExhYm9yYXRvcnkgbWlzc2lvbiAoTVNMKVwiKTtcbiAgICBwaWNrZXJzVmlld01vZGVsLnNldChcInNwaXJpdERlc2NyaXB0aW9uXCIsIFwiQ3VyaW9zaXR5IGlzIGEgY2FyLXNpemVkIHJvYm90aWMgcm92ZXIgZXhwbG9yaW5nIEdhbGUgQ3JhdGVyIG9uIE1hcnMgYXMgcGFydCBvZiBOQVNBJ3MgTWFycyBTY2llbmNlIExhYm9yYXRvcnkgbWlzc2lvbiAoTVNMKVwiKTtcblxuICAgIHBpY2tlcnNWaWV3TW9kZWwuYWRkRXZlbnRMaXN0ZW5lcihPYnNlcnZhYmxlLnByb3BlcnR5Q2hhbmdlRXZlbnQsIGZ1bmN0aW9uIChhcmdzOiBQcm9wZXJ0eUNoYW5nZURhdGEpIHtcbiAgICAgICAgaWYgKGFyZ3MucHJvcGVydHlOYW1lLnRvU3RyaW5nKCkgPT09IFwic2VsZWN0ZWRJbmRleEN1clwiKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGFyZ3MudmFsdWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwiaXNDdXJJbmZvVmlzaWJsZVwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcImlzQ3VySW5mb1Zpc2libGVcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcGlja2Vyc1ZpZXdNb2RlbC5hZGRFdmVudExpc3RlbmVyKE9ic2VydmFibGUucHJvcGVydHlDaGFuZ2VFdmVudCwgZnVuY3Rpb24gKGFyZ3M6IFByb3BlcnR5Q2hhbmdlRGF0YSkge1xuICAgICAgICBpZiAoYXJncy5wcm9wZXJ0eU5hbWUudG9TdHJpbmcoKSA9PT0gXCJzZWxlY3RlZEluZGV4T3BwXCIpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoYXJncy52YWx1ZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJpc09wcEluZm9WaXNpYmxlXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIHBpY2tlcnNWaWV3TW9kZWwuc2V0KFwiaXNPcHBJbmZvVmlzaWJsZVwiLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBwaWNrZXJzVmlld01vZGVsLmFkZEV2ZW50TGlzdGVuZXIoT2JzZXJ2YWJsZS5wcm9wZXJ0eUNoYW5nZUV2ZW50LCBmdW5jdGlvbiAoYXJnczogUHJvcGVydHlDaGFuZ2VEYXRhKSB7XG4gICAgICAgIGlmIChhcmdzLnByb3BlcnR5TmFtZS50b1N0cmluZygpID09PSBcInNlbGVjdGVkSW5kZXhTcGlcIikge1xuICAgICAgICAgICAgc3dpdGNoIChhcmdzLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBwaWNrZXJzVmlld01vZGVsLnNldChcImlzU3BpSW5mb1Zpc2libGVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgcGlja2Vyc1ZpZXdNb2RlbC5zZXQoXCJpc1NwaUluZm9WaXNpYmxlXCIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbiJdfQ==